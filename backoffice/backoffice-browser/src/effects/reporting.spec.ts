import { Actions } from '@ngrx/effects';
import { Observable } from 'rxjs/Rx';
import { cold, hot } from 'jest-marbles';

import { Bearbeitungscode } from 'lik-shared/common/models';

import { prepareMonthlyData, prepareOrganisationData, preparePmsProblemeData } from '../common/report-functions';

// prettier-ignore
const testData = {
    input: {
        monthly: { reportType: "monthly" as "monthly", preismeldestellen: [{ pms: { _id: "pms_10025", _rev: "1-e21234", preissubsystem: 2, pmsNummer: "10025", name: "xyz", supplement: "", street: "bbs sf 22", postcode: "3011", town: "Bern", telephone: "089222222222", email: "", languageCode: "de", erhebungsart: "100000", erhebungsartComment: "", pmsGeschlossen: null, pmsTop: false, internetLink: 'http://localhost/test', erhebungsregion: "Bern", zusatzInformationen: "asfasg asgasg", kontaktpersons: [{ oid: "22018", firstName: "xyz", surname: "xyz", personFunction: "chief 123", telephone: "089222222222", mobile: "", fax: "", email: "", languageCode: "de" }, { oid: "3171", firstName: "xyz", surname: "xyz", personFunction: "chief 123", telephone: "089222222222", mobile: "", fax: "", email: "", languageCode: "de" }] }, erhebungsarten: { tablet: true, telefon: false, email: false, internet: false, papierlisteVorOrt: false, papierlisteAbgegeben: false } }, { pms: { _id: "pms_10027", _rev: "1-2b1234", preissubsystem: 2, pmsNummer: "10027", name: "xyz", supplement: "ag asgkals", street: "bbs sf 22", postcode: "3011", town: "Bern", telephone: "089222222222", email: "", languageCode: "de", erhebungsart: "100000", erhebungsartComment: "", pmsGeschlossen: null, pmsTop: true, internetLink: '', erhebungsregion: "Bern", zusatzInformationen: "", kontaktpersons: [{ oid: "3173", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "089222222222", mobile: "", fax: "", email: "", languageCode: "de" }, { oid: "", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "", mobile: "", fax: "", email: "", languageCode: null }] }, erhebungsarten: { tablet: true, telefon: false, email: false, internet: false, papierlisteVorOrt: false, papierlisteAbgegeben: false } }, { pms: { _id: "pms_10714", _rev: "1-171234", preissubsystem: 2, pmsNummer: "10714", name: "xyz", supplement: "", street: "bbs sf 22", postcode: "9013", town: "St. Gallen", telephone: "089222222222", email: "", languageCode: "de", erhebungsart: "010000", erhebungsartComment: "", pmsGeschlossen: null, pmsTop: false, internetLink: '', erhebungsregion: "St. Gallen", zusatzInformationen: "kglajskg askg aksgjaksg", kontaktpersons: [{ oid: "3426", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "089222222222", mobile: "", fax: "", email: "", languageCode: "de" }, { oid: "", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "", mobile: "", fax: "", email: "", languageCode: null }] }, erhebungsarten: { tablet: false, telefon: true, email: false, internet: false, papierlisteVorOrt: false, papierlisteAbgegeben: false } }, { pms: { _id: "pms_11533", _rev: "1-1d1234", preissubsystem: 2, pmsNummer: "11533", name: "xyz", supplement: "ag asgkals", street: "bbs sf 22", postcode: "1003", town: "Lausanne", telephone: "089222222222", email: "", languageCode: "fr", erhebungsart: "100000", erhebungsartComment: "", pmsGeschlossen: null, pmsTop: false, internetLink: '', erhebungsregion: "Lausanne", zusatzInformationen: "", kontaktpersons: [{ oid: "6942", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "089222222222", mobile: "", fax: "", email: "", languageCode: null }, { oid: "", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "", mobile: "", fax: "", email: "", languageCode: null }] }, erhebungsarten: { tablet: true, telefon: false, email: false, internet: false, papierlisteVorOrt: false, papierlisteAbgegeben: false } }, { pms: { _id: "pms_11581", _rev: "1-041234", preissubsystem: 2, pmsNummer: "11581", name: "xyz", supplement: "", street: "bbs sf 22", postcode: "1003", town: "Lausanne", telephone: "089222222222", email: "asfksk@localhost", languageCode: "fr", erhebungsart: "100000", erhebungsartComment: "", pmsGeschlossen: null, pmsTop: false, internetLink: '', erhebungsregion: "Lausanne", zusatzInformationen: "agkasjglka sgka skglaskg", kontaktpersons: [{ oid: "22042", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "089222222222", mobile: "", fax: "", email: "asfksk@localhost", languageCode: "fr" }, { oid: "", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "", mobile: "", fax: "", email: "", languageCode: null }] }, erhebungsarten: { tablet: true, telefon: false, email: false, internet: false, papierlisteVorOrt: false, papierlisteAbgegeben: false } }], preismeldungen: [{ pmId: "pm_11533_ep_9313_lauf_1", preismeldung: { _id: "pm_11533_ep_9313_lauf_1", _rev: "12-31234", pmsNummer: "11533", epNummer: "9313", laufnummer: "1", preis: "3.95", menge: "1", preisVPK: null, mengeVPK: null, fehlendePreiseR: "R", preisVorReduktion: "4.95", mengeVorReduktion: "1", datumVorReduktion: "", aktion: true, artikelnummer: "", artikeltext: "test asg sag 13", bemerkungen: "asglakslögk alskgölaskglöaskglaksög", notiz: "", erhebungsZeitpunkt: null, kommentar: "", sortierungsnummer: 1, productMerkmale: [], modifiedAt: "2018-04-10T11:05:13.023+02:00", bearbeitungscode: 101 as any, uploadRequestedAt: "2018-08-06T09:04:40.080Z", istAbgebucht: true, d_DPToVP: { percentage: 0, warning: false, limitType: null, textzeil: null }, d_DPToVPVorReduktion: { percentage: -20.2020202020202, warning: false, limitType: null, textzeil: null }, d_DPToVPK: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPAlterArtikel: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVP: { percentage: null, warning: false, limitType: null, textzeil: null }, internetLink: "", erfasstAt: 1523351113008 }, refPreismeldung: { _id: "pm-ref_11533_ep_9313_lauf_1", _rev: "1-3b1234", pmId: "pm_11533_ep_9313_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "11533", epNummer: "9313", laufnummer: "1", preis: 3.95, menge: 1, aktion: true, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.06.2016", basisPreis: 4.95, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "asglakslögk alskgölaskglöaskglaksög", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 3, preisVorReduktion: 4.95, mengeVorReduktion: 1, datumVorReduktion: "", productMerkmale: [] }, sortierungsnummer: 1, warenkorbPosition: null }, { pmId: "pm_10025_ep_11141_lauf_1", preismeldung: { _id: "pm_10025_ep_11141_lauf_1", _rev: "4-5e1234", pmsNummer: "10025", epNummer: "11141", laufnummer: "1", preis: "3.30", menge: "1", preisVPK: null, mengeVPK: null, fehlendePreiseR: "", preisVorReduktion: "3.30", mengeVorReduktion: "1", datumVorReduktion: "05.04.2018", aktion: false, artikelnummer: "", artikeltext: "test asg sag 13", bemerkungen: "", notiz: "", erhebungsZeitpunkt: null, kommentar: "", productMerkmale: [], modifiedAt: "2018-04-05T10:41:14.235+02:00", bearbeitungscode: 99 as any, uploadRequestedAt: "2018-04-09T14:45:30.086Z", istAbgebucht: true, d_DPToVP: { percentage: 0, warning: false, limitType: null, textzeil: null }, d_DPToVPVorReduktion: { percentage: 0, warning: false, limitType: null, textzeil: null }, d_DPToVPK: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPAlterArtikel: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVP: { percentage: null, warning: false, limitType: null, textzeil: null }, internetLink: "", erfasstAt: 1522917674225 }, refPreismeldung: { _id: "pm-ref_10025_ep_11141_lauf_1", _rev: "1-411234", pmId: "pm_10025_ep_11141_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "10025", epNummer: "11141", laufnummer: "1", preis: 3.3, menge: 1, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.07.2017", basisPreis: 3, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 10, preisVorReduktion: 3.3, mengeVorReduktion: 1, datumVorReduktion: "02.03.2018", productMerkmale: [] }, sortierungsnummer: 2, warenkorbPosition: null }, { pmId: "pm_10027_ep_11136_lauf_2", preismeldung: { _id: "pm_10027_ep_11136_lauf_2", _rev: "6-7d1234", pmsNummer: "10027", epNummer: "11136", laufnummer: "2", preis: "9.50", menge: "1", preisVPK: null, mengeVPK: null, fehlendePreiseR: "", preisVorReduktion: "9.50", mengeVorReduktion: "1", datumVorReduktion: "05.04.2018", aktion: false, artikelnummer: "", artikeltext: "test asg sag 13", bemerkungen: "", notiz: "", erhebungsZeitpunkt: null, kommentar: "", productMerkmale: [], modifiedAt: "2018-04-05T14:18:42.792+02:00", bearbeitungscode: 1 as any, uploadRequestedAt: "2018-04-09T16:50:20.754Z", istAbgebucht: true, d_DPToVP: { percentage: 0, warning: false, limitType: null, textzeil: null }, d_DPToVPVorReduktion: { percentage: 0, warning: false, limitType: null, textzeil: null }, d_DPToVPK: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPAlterArtikel: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVP: { percentage: null, warning: false, limitType: null, textzeil: null }, internetLink: "", erfasstAt: 1522930722769 }, refPreismeldung: { _id: "pm-ref_10027_ep_11136_lauf_2", _rev: "1-741234", pmId: "pm_10027_ep_11136_lauf_2", preissubsystem: 2, schemanummer: 0, pmsNummer: "10027", epNummer: "11136", laufnummer: "2", preis: 9.5, menge: 1, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.05.2016", basisPreis: 9.5, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 1, preisVorReduktion: 9.5, mengeVorReduktion: 1, datumVorReduktion: "01.03.2018", productMerkmale: [] }, sortierungsnummer: 3, warenkorbPosition: null }, { pmId: "pm_11581_ep_3008_lauf_1", preismeldung: { _id: "pm_11581_ep_3008_lauf_1", _rev: "5-731234", pmsNummer: "11581", epNummer: "3008", laufnummer: "1", preis: "450.00", menge: "1", preisVPK: null, mengeVPK: null, fehlendePreiseR: "", preisVorReduktion: "450.00", mengeVorReduktion: "1", datumVorReduktion: "12.04.2018", aktion: false, artikelnummer: "0008", artikeltext: "test asg sag 13", bemerkungen: "asglakslögk alskgölaskglöaskglaksög", notiz: "", erhebungsZeitpunkt: null, kommentar: "kommentar-autotext_abnormale-preisentwicklung-bestaetigt¶", productMerkmale: ["8js", "100 polyester", "."], modifiedAt: "2018-04-12T12:22:13.346+02:00", bearbeitungscode: 99 as any, uploadRequestedAt: "2018-04-12T12:59:14.923Z", istAbgebucht: true, d_DPToVP: { percentage: 200, warning: true, limitType: "positiveLimite" as any, textzeil: "text_textzeil_limitverletzung" }, d_DPToVPVorReduktion: { percentage: 200, warning: false, limitType: null, textzeil: null }, d_DPToVPK: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPAlterArtikel: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVP: { percentage: null, warning: false, limitType: null, textzeil: null }, internetLink: "", erfasstAt: 1523528533329 }, refPreismeldung: { _id: "pm-ref_11581_ep_3008_lauf_1", _rev: "1-5a1234", pmId: "pm_11581_ep_3008_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "11581", epNummer: "3008", laufnummer: "1", preis: 150, menge: 1, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "0008", preisGueltigSeitDatum: "01.03.2018", basisPreis: 150, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 19, preisVorReduktion: 150, mengeVorReduktion: 1, datumVorReduktion: "09.03.2018", productMerkmale: ["8js", "100 polyester", "."] }, sortierungsnummer: 4, warenkorbPosition: null }, { pmId: "pm_10714_ep_4096_lauf_1", preismeldung: { _id: "pm_10714_ep_4096_lauf_1", _rev: "12-91234", pmsNummer: "10714", epNummer: "4096", laufnummer: "1", preis: "85.80", menge: "100", preisVPK: null, mengeVPK: null, fehlendePreiseR: "", preisVorReduktion: "85.80", mengeVorReduktion: "100", datumVorReduktion: "03.04.2018", aktion: false, artikelnummer: "", artikeltext: "test asg sag 13", bemerkungen: "", notiz: "", erhebungsZeitpunkt: 1 as any, kommentar: "", productMerkmale: [], modifiedAt: "2018-04-03T10:27:17.729+02:00", bearbeitungscode: 99 as any, uploadRequestedAt: "2018-04-06T10:41:45.251Z", istAbgebucht: true, d_DPToVP: { percentage: 3.3734939759036173, warning: false, limitType: null, textzeil: null }, d_DPToVPVorReduktion: { percentage: 3.3734939759036173, warning: false, limitType: null, textzeil: null }, d_DPToVPK: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPAlterArtikel: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVP: { percentage: null, warning: false, limitType: null, textzeil: null }, internetLink: "", erfasstAt: 1522744037707 }, refPreismeldung: { _id: "pm-ref_10714_ep_4096_lauf_1", _rev: "1-391234", pmId: "pm_10714_ep_4096_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "10714", epNummer: "4096", laufnummer: "1", preis: 83, menge: 100, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.03.2018", basisPreis: 34.9, basisMenge: 100, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: 1 as any, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "03.04.2018", sortierungsnummer: 6, preisVorReduktion: 83, mengeVorReduktion: 100, datumVorReduktion: "01.03.2018", productMerkmale: [] }, sortierungsnummer: 5, warenkorbPosition: null }], erhebungsmonat: "01.04.2018", refPreismeldungen: [{ _id: "pm-ref_10025_ep_11141_lauf_1", _rev: "1-411234", pmId: "pm_10025_ep_11141_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "10025", epNummer: "11141", laufnummer: "1", preis: 3.3, menge: 1, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.07.2017", basisPreis: 3, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 10, preisVorReduktion: 3.3, mengeVorReduktion: 1, datumVorReduktion: "02.03.2018", productMerkmale: [] }, { _id: "pm-ref_10027_ep_11136_lauf_2", _rev: "1-741234", pmId: "pm_10027_ep_11136_lauf_2", preissubsystem: 2, schemanummer: 0, pmsNummer: "10027", epNummer: "11136", laufnummer: "2", preis: 9.5, menge: 1, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.05.2016", basisPreis: 9.5, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 1, preisVorReduktion: 9.5, mengeVorReduktion: 1, datumVorReduktion: "01.03.2018", productMerkmale: [] }, { _id: "pm-ref_10714_ep_4096_lauf_1", _rev: "1-391234", pmId: "pm_10714_ep_4096_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "10714", epNummer: "4096", laufnummer: "1", preis: 83, menge: 100, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.03.2018", basisPreis: 34.9, basisMenge: 100, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: 1 as any, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "03.04.2018", sortierungsnummer: 6, preisVorReduktion: 83, mengeVorReduktion: 100, datumVorReduktion: "01.03.2018", productMerkmale: [] }, { _id: "pm-ref_11533_ep_9313_lauf_1", _rev: "1-3b1234", pmId: "pm_11533_ep_9313_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "11533", epNummer: "9313", laufnummer: "1", preis: 3.95, menge: 1, aktion: true, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.06.2016", basisPreis: 4.95, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "asglakslögk alskgölaskglöaskglaksög", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 3, preisVorReduktion: 4.95, mengeVorReduktion: 1, datumVorReduktion: "", productMerkmale: [] }, { _id: "pm-ref_11581_ep_3008_lauf_1", _rev: "1-5a1234", pmId: "pm_11581_ep_3008_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "11581", epNummer: "3008", laufnummer: "1", preis: 150, menge: 1, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "0008", preisGueltigSeitDatum: "01.03.2018", basisPreis: 150, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 19, preisVorReduktion: 150, mengeVorReduktion: 1, datumVorReduktion: "09.03.2018", productMerkmale: ["8js", "100 polyester", "."] }] },
        organisation: { reportType: "organisation" as "organisation", preismeldestellen: [{ _id: "pms_10025", _rev: "1-e21234", preissubsystem: 2, pmsNummer: "10025", name: "xyz", supplement: "", street: "bbs sf 22", postcode: "3011", town: "Bern", telephone: "089222222222", email: "", languageCode: "de", erhebungsart: "100000", erhebungsartComment: "", pmsGeschlossen: null, pmsTop: false, internetLink: "http://localhost/test", erhebungsregion: "Bern", zusatzInformationen: "asfasg asgasg", kontaktpersons: [{ oid: "22018", firstName: "xyz", surname: "xyz", personFunction: "chief 123", telephone: "089222222222", mobile: "", fax: "", email: "", languageCode: "de" }, { oid: "3171", firstName: "xyz", surname: "xyz", personFunction: "chief 123", telephone: "089222222222", mobile: "", fax: "", email: "", languageCode: "de" }] }, { _id: "pms_10027", _rev: "1-2b1234", preissubsystem: 2, pmsNummer: "10027", name: "xyz", supplement: "ag asgkals", street: "bbs sf 22", postcode: "3011", town: "Bern", telephone: "089222222222", email: "", languageCode: "de", erhebungsart: "100000", erhebungsartComment: "", pmsGeschlossen: null, pmsTop: true, internetLink: "", erhebungsregion: "Bern", zusatzInformationen: "", kontaktpersons: [{ oid: "3173", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "089222222222", mobile: "", fax: "", email: "", languageCode: "de" }, { oid: "", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "", mobile: "", fax: "", email: "", languageCode: null }] }, { _id: "pms_10714", _rev: "1-171234", preissubsystem: 2, pmsNummer: "10714", name: "xyz", supplement: "", street: "bbs sf 22", postcode: "9013", town: "St. Gallen", telephone: "089222222222", email: "", languageCode: "de", erhebungsart: "010000", erhebungsartComment: "", pmsGeschlossen: null, pmsTop: false, internetLink: "", erhebungsregion: "St. Gallen", zusatzInformationen: "kglajskg askg aksgjaksg", kontaktpersons: [{ oid: "3426", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "089222222222", mobile: "", fax: "", email: "", languageCode: "de" }, { oid: "", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "", mobile: "", fax: "", email: "", languageCode: null }] }, { _id: "pms_11533", _rev: "1-1d1234", preissubsystem: 2, pmsNummer: "11533", name: "xyz", supplement: "ag asgkals", street: "bbs sf 22", postcode: "1003", town: "Lausanne", telephone: "089222222222", email: "", languageCode: "fr", erhebungsart: "100000", erhebungsartComment: "", pmsGeschlossen: null, pmsTop: false, internetLink: "", erhebungsregion: "Lausanne", zusatzInformationen: "", kontaktpersons: [{ oid: "6942", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "089222222222", mobile: "", fax: "", email: "", languageCode: null }, { oid: "", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "", mobile: "", fax: "", email: "", languageCode: null }] }, { _id: "pms_11581", _rev: "1-041234", preissubsystem: 2, pmsNummer: "11581", name: "xyz", supplement: "", street: "bbs sf 22", postcode: "1003", town: "Lausanne", telephone: "089222222222", email: "asfksk@localhost", languageCode: "fr", erhebungsart: "100000", erhebungsartComment: "", pmsGeschlossen: null, pmsTop: false, internetLink: "", erhebungsregion: "Lausanne", zusatzInformationen: "agkasjglka sgka skglaskg", kontaktpersons: [{ oid: "22042", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "089222222222", mobile: "", fax: "", email: "asfksk@localhost", languageCode: "fr" }, { oid: "", firstName: "xyz", surname: "xyz", personFunction: "", telephone: "", mobile: "", fax: "", email: "", languageCode: null }] }], preismeldungen: [{ _id: "pm_11533_ep_9313_lauf_1", _rev: "12-31234", pmsNummer: "11533", epNummer: "9313", laufnummer: "1", preis: "3.95", menge: "1", preisVPK: null, mengeVPK: null, fehlendePreiseR: "R", preisVorReduktion: "4.95", mengeVorReduktion: "1", datumVorReduktion: "", aktion: true, artikelnummer: "", artikeltext: "test asg sag 13", bemerkungen: "asglakslögk alskgölaskglöaskglaksög", notiz: "", erhebungsZeitpunkt: null, kommentar: "", sortierungsnummer: 1, productMerkmale: [], modifiedAt: "2018-04-10T11:05:13.023+02:00", bearbeitungscode: 101 as any, uploadRequestedAt: "2018-08-06T09:04:40.080Z", istAbgebucht: true, d_DPToVP: { percentage: 0, warning: false, limitType: null, textzeil: null }, d_DPToVPVorReduktion: { percentage: -20.2020202020202, warning: false, limitType: null, textzeil: null }, d_DPToVPK: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPAlterArtikel: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVP: { percentage: null, warning: false, limitType: null, textzeil: null }, internetLink: "", erfasstAt: 1523351113008 }, { _id: "pm_10025_ep_11141_lauf_1", _rev: "4-5e1234", pmsNummer: "10025", epNummer: "11141", laufnummer: "1", preis: "3.30", menge: "1", preisVPK: null, mengeVPK: null, fehlendePreiseR: "", preisVorReduktion: "3.30", mengeVorReduktion: "1", datumVorReduktion: "05.04.2018", aktion: false, artikelnummer: "", artikeltext: "test asg sag 13", bemerkungen: "", notiz: "", erhebungsZeitpunkt: null, kommentar: "", productMerkmale: [], modifiedAt: "2018-04-05T10:41:14.235+02:00", bearbeitungscode: 99 as any, uploadRequestedAt: "2018-04-09T14:45:30.086Z", istAbgebucht: true, d_DPToVP: { percentage: 0, warning: false, limitType: null, textzeil: null }, d_DPToVPVorReduktion: { percentage: 0, warning: false, limitType: null, textzeil: null }, d_DPToVPK: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPAlterArtikel: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVP: { percentage: null, warning: false, limitType: null, textzeil: null }, internetLink: "", erfasstAt: 1522917674225 }, { _id: "pm_10027_ep_11136_lauf_2", _rev: "6-7d1234", pmsNummer: "10027", epNummer: "11136", laufnummer: "2", preis: "9.50", menge: "1", preisVPK: null, mengeVPK: null, fehlendePreiseR: "", preisVorReduktion: "9.50", mengeVorReduktion: "1", datumVorReduktion: "05.04.2018", aktion: false, artikelnummer: "", artikeltext: "test asg sag 13", bemerkungen: "", notiz: "", erhebungsZeitpunkt: null, kommentar: "", productMerkmale: [], modifiedAt: "2018-04-05T14:18:42.792+02:00", bearbeitungscode: 1 as any, uploadRequestedAt: "2018-04-09T16:50:20.754Z", istAbgebucht: true, d_DPToVP: { percentage: 0, warning: false, limitType: null, textzeil: null }, d_DPToVPVorReduktion: { percentage: 0, warning: false, limitType: null, textzeil: null }, d_DPToVPK: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPAlterArtikel: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVP: { percentage: null, warning: false, limitType: null, textzeil: null }, internetLink: "", erfasstAt: 1522930722769 }, { _id: "pm_11581_ep_3008_lauf_1", _rev: "5-731234", pmsNummer: "11581", epNummer: "3008", laufnummer: "1", preis: "450.00", menge: "1", preisVPK: null, mengeVPK: null, fehlendePreiseR: "", preisVorReduktion: "450.00", mengeVorReduktion: "1", datumVorReduktion: "12.04.2018", aktion: false, artikelnummer: "0008", artikeltext: "test asg sag 13", bemerkungen: "asglakslögk alskgölaskglöaskglaksög", notiz: "", erhebungsZeitpunkt: null, kommentar: "kommentar-autotext_abnormale-preisentwicklung-bestaetigt¶", productMerkmale: ["8js", "100 polyester", "."], modifiedAt: "2018-04-12T12:22:13.346+02:00", bearbeitungscode: 99 as any, uploadRequestedAt: "2018-04-12T12:59:14.923Z", istAbgebucht: true, d_DPToVP: { percentage: 200, warning: true, limitType: "positiveLimite" as any, textzeil: "text_textzeil_limitverletzung" }, d_DPToVPVorReduktion: { percentage: 200, warning: false, limitType: null, textzeil: null }, d_DPToVPK: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPAlterArtikel: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVP: { percentage: null, warning: false, limitType: null, textzeil: null }, internetLink: "", erfasstAt: 1523528533329 }, { _id: "pm_10714_ep_4096_lauf_1", _rev: "12-91234", pmsNummer: "10714", epNummer: "4096", laufnummer: "1", preis: "85.80", menge: "100", preisVPK: null, mengeVPK: null, fehlendePreiseR: "", preisVorReduktion: "85.80", mengeVorReduktion: "100", datumVorReduktion: "03.04.2018", aktion: false, artikelnummer: "", artikeltext: "test asg sag 13", bemerkungen: "", notiz: "", erhebungsZeitpunkt: 1 as any, kommentar: "", productMerkmale: [], modifiedAt: "2018-04-03T10:27:17.729+02:00", bearbeitungscode: 99 as any, uploadRequestedAt: "2018-04-06T10:41:45.251Z", istAbgebucht: true, d_DPToVP: { percentage: 3.3734939759036173, warning: false, limitType: null, textzeil: null }, d_DPToVPVorReduktion: { percentage: 3.3734939759036173, warning: false, limitType: null, textzeil: null }, d_DPToVPK: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPAlterArtikel: { percentage: null, warning: false, limitType: null, textzeil: null }, d_VPKToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVPVorReduktion: { percentage: null, warning: false, limitType: null, textzeil: null }, d_DPVorReduktionToVP: { percentage: null, warning: false, limitType: null, textzeil: null }, internetLink: "", erfasstAt: 1522744037707 },], refPreismeldungen: [{ _id: "pm-ref_10025_ep_11141_lauf_1", _rev: "1-411234", pmId: "pm_10025_ep_11141_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "10025", epNummer: "11141", laufnummer: "1", preis: 3.3, menge: 1, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.07.2017", basisPreis: 3, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 10, preisVorReduktion: 3.3, mengeVorReduktion: 1, datumVorReduktion: "02.03.2018", productMerkmale: [] }, { _id: "pm-ref_10027_ep_11136_lauf_2", _rev: "1-741234", pmId: "pm_10027_ep_11136_lauf_2", preissubsystem: 2, schemanummer: 0, pmsNummer: "10027", epNummer: "11136", laufnummer: "2", preis: 9.5, menge: 1, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.05.2016", basisPreis: 9.5, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 1, preisVorReduktion: 9.5, mengeVorReduktion: 1, datumVorReduktion: "01.03.2018", productMerkmale: [] }, { _id: "pm-ref_10714_ep_4096_lauf_1", _rev: "1-391234", pmId: "pm_10714_ep_4096_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "10714", epNummer: "4096", laufnummer: "1", preis: 83, menge: 100, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.03.2018", basisPreis: 34.9, basisMenge: 100, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: 1 as any, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "03.04.2018", sortierungsnummer: 6, preisVorReduktion: 83, mengeVorReduktion: 100, datumVorReduktion: "01.03.2018", productMerkmale: [] }, { _id: "pm-ref_11533_ep_9313_lauf_1", _rev: "1-3b1234", pmId: "pm_11533_ep_9313_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "11533", epNummer: "9313", laufnummer: "1", preis: 3.95, menge: 1, aktion: true, artikeltext: "test asg sag 13", artikelnummer: "", preisGueltigSeitDatum: "01.06.2016", basisPreis: 4.95, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "asglakslögk alskgölaskglöaskglaksög", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 3, preisVorReduktion: 4.95, mengeVorReduktion: 1, datumVorReduktion: "", productMerkmale: [] }, { _id: "pm-ref_11581_ep_3008_lauf_1", _rev: "1-5a1234", pmId: "pm_11581_ep_3008_lauf_1", preissubsystem: 2, schemanummer: 0, pmsNummer: "11581", epNummer: "3008", laufnummer: "1", preis: 150, menge: 1, aktion: false, artikeltext: "test asg sag 13", artikelnummer: "0008", preisGueltigSeitDatum: "01.03.2018", basisPreis: 150, basisMenge: 1, fehlendePreiseR: "", notiz: "", bemerkungen: "", internetLink: "", erhebungsZeitpunkt: null, erhebungsAnfangsDatum: "03.04.2018", erhebungsEndDatum: "12.04.2018", sortierungsnummer: 19, preisVorReduktion: 150, mengeVorReduktion: 1, datumVorReduktion: "09.03.2018", productMerkmale: ["8js", "100 polyester", "."] }], preiszuweisungen: [{ _id: "aaaaac", _rev: "18-c1234", preiserheberId: "aaaaac", preismeldestellenNummern: ["11531", "11533", "11569", "11571", "11573", "11602", "11614", "12448", "12453", "14195", "14202", "14601", "11579", "14412", "11575", "12918", "12920", "11548", "11563", "8126", "8215", "8308", "8314", "8487", "8563", "14455"] }, { _id: "bbbbbbc", _rev: "7-df1234", preiserheberId: "bbbbbbc", preismeldestellenNummern: ["10084", "10682", "10683", "10685", "10686", "10687", "10688", "10689", "10714", "10718", "10723", "10729", "10737", "10738", "10742", "10746", "10748", "10757", "10762", "10782", "10790", "12837", "14071", "14076", "14233", "14300", "14448", "14562", "18002", "10745", "14531", "14078", "10725", "10727", "12902"] }, { _id: "hgssssss", _rev: "4-1d1234", preiserheberId: "hgssssss", preismeldestellenNummern: ["10025", "10033", "10047", "10130", "10181", "10183", "12519", "12886", "14438", "14494", "14543", "10101", "10103", "10114", "14559", "10038", "10086", "12520", "14554"] }, { _id: "sssssss", _rev: "7-d51234", preiserheberId: "sssssss", preismeldestellenNummern: ["8118", "8197", "8253", "8319", "8396", "8461", "8503", "8522", "8543", "8544", "8553", "8569", "11545", "11576", "11577", "8191", "8195", "8286", "8301", "8337", "8339", "8341", "8345", "8500", "8508", "8516", "8546", "8556", "8571", "8457", "8459", "8460", "8252", "8551", "11581", "8289", "8290", "8298", "8518", "8519", "8554"] }, { _id: "hgssssttttttt", _rev: "4-0e1234", preiserheberId: "hgssssttttttt", preismeldestellenNummern: ["10027", "10059", "10060", "10131", "10162", "10172", "14010", "14495", "14594", "11992", "14547"] }], preiserheber: [{ _id: "aaaaac", _rev: "12-41234", peNummer: 1533563528, firstName: "chief 123", surname: "chief 123", erhebungsregion: "Lausanne", languageCode: "de", telephone: "089222222222", mobilephone: "089222222222", email: "asfksk@localhost", fax: null, webseite: null, street: "bbs sf 22", postcode: "15674 ", town: "Vuarmarens", username: "aaaaac" }, { _id: "bbbbbbc", _rev: "1-661234", peNummer: 1511089196, firstName: "chief 123", surname: "chief 123", erhebungsregion: "St. Gallen", languageCode: "de", telephone: "089222222222", mobilephone: "089222222222", email: null, fax: null, webseite: null, street: "bbs sf 22", postcode: "9100", town: "Herisau", username: "bbbbbbc" }, { _id: "hgssssss", _rev: "2-711234", peNummer: 1511184422, firstName: "chief 123", surname: "chief 123", erhebungsregion: "Bern", languageCode: "de", telephone: "089222222222", mobilephone: "089222222222", email: "asfksk@localhost", fax: null, webseite: null, street: "bbs sf 22", postcode: "3084", town: "Wabern", username: "hgssssss" }, { _id: "sssssss", _rev: "2-d01234", peNummer: 1511089681, firstName: "chief 123", surname: "chief 123", erhebungsregion: "Genève", languageCode: "fr", telephone: null, mobilephone: null, email: null, fax: null, webseite: null, street: null, postcode: null, town: null, username: "sssssss" }, { _id: "hgssssttttttt", _rev: "1-641234", peNummer: 1511335314, firstName: "chief 123", surname: "chief 123", erhebungsregion: "Bern", languageCode: "de", telephone: null, mobilephone: "089222222222", email: "asfksk@localhost", fax: null, webseite: null, street: "bbs sf 22", postcode: "3073", town: "Gümligen", username: "hgssssttttttt" }], erhebungsmonat: "01.04.2018" },
        pmsProblems: { reportType: "pmsProblems" as "pmsProblems", preismeldestellen: [ { _id: "pms_10115", _rev: "1-163bb0744c3744e7603ea0be018ec1cc", preissubsystem: 2, pmsNummer: "10115", name: "fasg as gasg", supplement: "fasg gasg 2ttr2", street: "bbs sf 22", postcode: "5001", town: "Aarau", telephone: "fasg gasg 2ttr2", email: "", languageCode: "de", erhebungsart: "001001", erhebungsartComment: "klaslgaskgjklasjgkl 151", pmsGeschlossen: 1 as any, pmsTop: false, internetLink: "http://localhost/test", erhebungsregion: "Basel", zusatzInformationen: " asf akskfö lkaöslf köalsk ölfas", kontaktpersons: [ { oid: "10157", firstName: "fasg as gasg", surname: "fasg as gasg", personFunction: "chief 124", telephone: "fasg gasg 2ttr2", mobile: "", fax: "", email: "asfksk@localhost", languageCode: "de" }, { oid: "22202", firstName: "fasg as gasg", surname: "fasg as gasg", personFunction: "chief 124", telephone: "", mobile: "", fax: "", email: "asfksk@localhost", languageCode: null } ] }, { _id: "pms_10864", _rev: "1-0fae989851b5ddc90074adb968ff41ec", preissubsystem: 2, pmsNummer: "10864", name: "fasg as gasg", supplement: "fasg gasg 2ttr2", street: "bbs sf 22", postcode: "6004", town: "Luzern", telephone: "fasg gasg 2ttr2", email: "", languageCode: "de", erhebungsart: "100010", erhebungsartComment: "", pmsGeschlossen: 2 as any, pmsTop: true, internetLink: "", erhebungsregion: "Luzern", zusatzInformationen: "afsg asg asg\n\n\\naf sfa sflökaösl fkaöls kflöaskföls!", kontaktpersons: [ { oid: "22175", firstName: "fasg as gasg", surname: "fasg as gasg", personFunction: "", telephone: "fasg gasg 2ttr2", mobile: "", fax: "", email: "", languageCode: "de" }, { oid: "", firstName: "fasg as gasg", surname: "fasg as gasg", personFunction: "", telephone: "", mobile: "", fax: "", email: "", languageCode: null } ] }, { _id: "pms_14622", _rev: "2-94c78c825624421284673a0a0fd15457", preissubsystem: 2, pmsNummer: "14622", name: "fasg as gasg", supplement: "fasg gasg 2ttr2", street: "bbs sf 22", postcode: "6004", town: "Luzern", telephone: "fasg gasg 2ttr2", email: "asfksk@localhost", languageCode: "de", erhebungsart: "100010", erhebungsartComment: "", pmsGeschlossen: 3 as any, pmsTop: false, internetLink: "", erhebungsregion: "Luzern", zusatzInformationen: "asdg asg asga gsas gasg as gas gsags\n\nask fjlkasj flkjalsfj lkasjflkajsflk24 21lk lkysf.", kontaktpersons: [ { oid: "9383", firstName: "fasg as gasg", surname: "fasg as gasg", personFunction: "chief 124", telephone: "fasg gasg 2ttr2", mobile: "089223333333", fax: "", email: "asfksk@localhost", languageCode: "de" }, { oid: "22319", firstName: "fasg as gasg", surname: "fasg as gasg", personFunction: "", telephone: "", mobile: "", fax: "", email: "", languageCode: "de" } ] } ], erhebungsmonat: "01.04.2018" }
    },
    expected: {
        monthly: { bearbeitungsCode: { "0": 0, "1": 1, "101": 1, "2": 0, "3": 0, "44": 0, "7": 0, "99": 3, Aktion: 1, "N/A": 0 }, erhebungsart: { "N/A": 0, offline: 5, online: 0 }, erhebungsartDetailPm: { email: 0, internet: 0, papierlisteAbgegeben: 0, papierlisteVorOrt: 0, tablet: 4, telefon: 1, total: 5 }, erhebungsartDetailPms: { email: 0, internet: 0, papierlisteAbgegeben: 0, papierlisteVorOrt: 0, tablet: 4, telefon: 1, total: 5 }, preisentwicklungen: { aktionAusverkauf: 1, aktionsende: 0, gestiegen: 2, gesunken: 0, stabil: 3 }, preismeldungen: { erfasst: 5, new: 0, total: 5 }, zeitpunkt: { erhebungsmonat: "01.04.2018" } },
        organisation: { erhebungsregionen: { Bern: { pm: 2, pms: 2 }, Lausanne: { pm: 2, pms: 2 }, "N/A": { pm: 0, pms: 0 }, "St. Gallen": { pm: 1, pms: 1 } }, preiserheber: { "N/A": { pm: 0, pms: 0 }, "chief 123 chief 123": { pm: 5, pms: 5 } }, preismeldungen: { "10025 xyz": { peName: "chief 123 chief 123", pm: 1 }, "10027 xyz": { peName: "chief 123 chief 123", pm: 1 }, "10714 xyz": { peName: "chief 123 chief 123", pm: 1 }, "11533 xyz": { peName: "chief 123 chief 123", pm: 1 }, "11581 xyz": { peName: "chief 123 chief 123", pm: 1 }, "N/A": { peName: null, pm: 0 } }, zeitpunkt: { erhebungsmonat: "01.04.2018" } },
        pmsProblems: { pmsGeschlossen: [ { grund: "Ferien", name: "10115 fasg as gasg", zusatzinfo: " asf akskfö lkaöslf köalsk ölfas" }, { grund: "geschlossen (temporär)", name: "10864 fasg as gasg", zusatzinfo: "afsg asg asg\n\n\\naf sfa sflökaösl fkaöls kflöaskföls!" }, { grund: "Geschäftsaufgabe", name: "14622 fasg as gasg", zusatzinfo: "asdg asg asga gsas gasg as gas gsags\n\nask fjlkasj flkjalsfj lkasjflkajsflk24 21lk lkysf." } ], zeitpunkt: { erhebungsmonat: "01.04.2018" } }
    }
};

describe('Reporting Effects', () => {
    describe('Test prepare monthly report data', () => {
        test('should process data correctly', () => {
            const monthlyData = prepareMonthlyData(testData.input.monthly);
            delete monthlyData.zeitpunkt.erstellungsdatum;
            expect(monthlyData).toEqual(testData.expected.monthly);
        });
    });

    describe('Test prepare organisation report data', () => {
        test('should process data correctly', () => {
            const organisationData = prepareOrganisationData(testData.input.organisation);
            delete organisationData.zeitpunkt.erstellungsdatum;
            expect(organisationData).toEqual(testData.expected.organisation);
        });
    });

    describe('Test prepare pmsProblems report data', () => {
        test('should process data correctly', () => {
            const pmsProblemeData = preparePmsProblemeData(testData.input.pmsProblems);
            delete pmsProblemeData.zeitpunkt.erstellungsdatum;
            expect(pmsProblemeData).toEqual(testData.expected.pmsProblems);
        });
    });
});
