<div class="top-section">
    <div class="filter">
        <div class="status">
            <ion-list radio-group>
                <ion-item>
                    <ion-label>In Prüfung (unbestätigt)</ion-label>
                    <ion-radio [disabled]="hasStatusInputDisabled$ | async" value="1" [checked]="!(hasStatusInputDisabled$ | async) && (preismeldungStatusFilter$ | async) === 1" (ionSelect)="setPreismeldungStatusFilter$.emit(1)"></ion-radio>
                </ion-item>
                <ion-item>
                    <ion-label>In Prüfung (alle)</ion-label>
                    <ion-radio [disabled]="hasStatusInputDisabled$ | async" value="2" [checked]="!(hasStatusInputDisabled$ | async) && (preismeldungStatusFilter$ | async) === 2" (ionSelect)="setPreismeldungStatusFilter$.emit(2)"></ion-radio>
                </ion-item>
                <ion-item>
                    <ion-label>Alle Preise</ion-label>
                    <ion-radio [disabled]="hasStatusInputDisabled$ | async" value="3" [checked]="!(hasStatusInputDisabled$ | async) && (preismeldungStatusFilter$ | async) === 3" (ionSelect)="setPreismeldungStatusFilter$.emit(3)"></ion-radio>
                </ion-item>
            </ion-list>
            <h2>({{(preismeldungen$ | async)?.length || 0}})</h2>
        </div>
        <div class="controlling">
            <select #controllingSelect class="controlling-selected" (change)="controllingTypeSelected$.emit($event.target.value)">
                <option *ngFor="let controlling of controllings" [value]="controlling.name" [selected]="reportData?.controllingType === controlling.name">{{controlling.label}}</option>
            </select>
        </div>
    </div>
    <div class="actions">
        <button type="button" ion-button class="btn-execute" (click)="runReport$.emit(controllingSelect.value)">ausführen</button>
        <ng-content *ngIf="!(reportData$ | async)" select=".additional-actions"></ng-content>
        <button *ngIf="!!(reportData$ | async)" type="button" ion-button class="btn-execute" (click)="completeAllPreismeldungenStatusClicked$.emit()">Alle angezeigten Preismeldungen als geprüft markieren</button>
        <pef-zoom *ngIf="!!(reportData$ | async)" (zoomLevel)="zoomLevel$.emit($event)"></pef-zoom>
        <button *ngIf="!!(reportData$ | async)" type="button" ion-button class="btn-execute" (click)="clearControlling$.emit()">Leeren</button>
    </div>
</div>

<div class="table-wrapper" *ngIf="!!(reportData$ | async)">
    <table class="report-table" [pefZoomable]="zoomLevel$ | async">
        <thead>
            <tr>
                <th class="align-right">&nbsp;</th>
                <th class="align-right">&nbsp;</th>
                <th *ngFor="let column of (reportData$ | async)?.columns; let i = index" (click)="toggleColumn$.emit(i)" class="collapsable"
                    [class.collapsed]="(hiddenColumns$ | async)[i]" [title]="column">{{ shortColumnNames[column] || column }}</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let row of (preismeldungen$ | async)">
                <td>
                    <button [class.visibility-hidden]="!row.canView" ion-button class="edit-pm" (click)="editPreismeldungId$.emit(row.pmId)">
                        <pef-icon name="todo"></pef-icon>
                    </button>
                </td>
                <td>
                    <pef-pm-status [class.visibility-hidden]="!row.canView" [disabled]="row.exported" [preismeldungStatus]="preismeldungenStatus[row.pmId]" (setPreismeldungStatus)="setPreismeldungStatus$.emit({ pmId: row.pmId, status: $event })"></pef-pm-status>
                </td>
                <td *ngFor="let value of row.values; let i = index" [class.collapsed]="(hiddenColumns$ | async)[i]">{{ value }}</td>
            </tr>
        </tbody>
    </table>
    <span>&nbsp;</span>
</div>
