<button type="button" class="load-data" ion-button (click)="loadData$.emit()" [disabled]="reportExecuting$ | async">Statusbericht {{ (hasExecutedOnce$ | async) ? 'aktualisieren' : 'laden' }}</button>

<div class="container-wrapper" [class.hidden]="!(cockpitReportData$ | async)">
    <div class="container">
        <form [formGroup]="form" class="stacked-form">
            <div class="pef-item item item-block item-md item-label-stacked item-input">
                <div class="item-inner">
                    <div class="input-wrapper">
                        <ion-label stacked>Erhebungszeitpunkt</ion-label>
                        <div class="input input-md pef-select">
                            <select formControlName="erhebungsZeitpunkt">
                                <option value="indifferent">Indifferent</option>
                                <option value="stichtag1">Stichtag 1</option>
                                <option value="stichtag2">Stichtag 2</option>
                                <option value="woche1">Woche 1</option>
                                <option value="woche2">Woche 2</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <ion-item class="pef-item">
                <ion-label stacked>Preiserheber</ion-label>
                <ion-input type="text" formControlName="preiserheberFilter"></ion-input>
            </ion-item>
        </form>
        <div class="list-header">
            <div>
                <div class="name"></div>
                <div class="todo">todo</div>
                <div class="done">done</div>
                <div class="new-preismeldungen">neu</div>
            </div>
            <div>
                <div class="name"></div>
                <div class="todo">
                    <span class="status-number" [class.good]="(filteredSummary$ | async).todo == (filteredSummary$ | async).todoSynced">{{ (filteredSummary$ | async).todo }}</span>
                </div>
                <div class="done">
                    <span class="status-number" [class.good]="(filteredSummary$ | async).doneUploaded == (filteredSummary$ | async).todo">{{ (filteredSummary$ | async).done }}</span>
                </div>
                <div class="new-preismeldungen">
                    <span class="status-number" [class.good]="(filteredSummary$ | async).newPreismeldungen == (filteredSummary$ | async).newPreismeldungenUploaded">{{ (filteredSummary$ | async).newPreismeldungen }}</span>
                </div>
            </div>
        </div>
        <pef-virtual-scroll [items]="filteredPreiserheber$ | async" (update)="updateScrollList($event)" pef-perfect-scrollbar [enabled]="true">
            <ion-item class="pef-advanced-item" *ngFor="let preiserheber of scrollList" (click)="selectPreiserheber$.emit(preiserheber)"
                [class.selected]="(selectedPreiserheber$ | async)?.username == preiserheber.username" tappable>
                <div class="pef-item-description">
                    <span class="text">{{ preiserheber.erheber.firstName }} {{preiserheber.erheber.surname}}</span>
                    <span class="artikel-text">{{ preiserheber.erheber.erhebungsregion }}</span>
                </div>
                <div class="preiserheber-summary">
                    <div class="todo">
                        <span class="status-number" [class.good]="preiserheber.summary[form.value.erhebungsZeitpunkt].todo == preiserheber.summary[form.value.erhebungsZeitpunkt].todoSynced">{{ preiserheber.summary[form.value.erhebungsZeitpunkt].todo }}</span>
                    </div>
                    <div class="done">
                        <span class="status-number" [class.good]="preiserheber.summary[form.value.erhebungsZeitpunkt].doneUploaded == preiserheber.summary[form.value.erhebungsZeitpunkt].todo">{{ preiserheber.summary[form.value.erhebungsZeitpunkt].done }}</span>
                    </div>
                    <div class="new-preismeldungen">
                        <span class="status-number" [class.good]="preiserheber.summary[form.value.erhebungsZeitpunkt].newPreismeldungen == preiserheber.summary[form.value.erhebungsZeitpunkt].newPreismeldungenUploaded">{{ preiserheber.summary[form.value.erhebungsZeitpunkt].newPreismeldungen }}</span>
                    </div>
                </div>
            </ion-item>
        </pef-virtual-scroll>
    </div>

    <div class="container">
        <cockpit-report-detail [preiserheber]="selectedPreiserheber$ | async" [erhebungsZeitpunktKey]="form.value.erhebungsZeitpunkt"></cockpit-report-detail>
    </div>
</div>
