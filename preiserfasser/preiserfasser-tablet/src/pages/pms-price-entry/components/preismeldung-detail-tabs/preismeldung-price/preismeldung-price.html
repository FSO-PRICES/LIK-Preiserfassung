<form [formGroup]="form" *ngIf="!!(preismeldung$ | async)" [class.form-show-validation-hints]="showValidationHints$ | async" novalidate>
    <div class="header">
        <div class="header-line">
            <div class="product-heading">
                {{ (preismeldung$ | async).warenkorbPosition.gliederungspositionsnummer }} {{ (preismeldung$ | async).warenkorbPosition.bezeichnung | pefPropertyTranslate }}
            </div>
            <ion-item class="pef-item on-dark">
                <ion-label> Artikelnummer </ion-label>
                <ion-input
                    type="text"
                    formControlName="artikelNummer"
                    (blur)="formValueChanged$.emit('artikelNummer')"></ion-input>
            </ion-item>
            <div class="right-column"></div>
        </div>
        <div class="header-line">
            <ion-item class="pef-item on-dark">
                <ion-label> Artikeltext * </ion-label>
                <ion-input
                    type="text"
                    formControlName="artikelText"
                    [class.validation-error]="true"
                    (blur)="formValueChanged$.emit('artikelText')"></ion-input>
            </ion-item>
            <div class="right-column">
                <button ion-button icon-only class="pef-icon-secondary duplicate" [disabled]="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30">
                        <g fill="none" fill-rule="evenodd" transform="translate(6 5)">
                            <polygon class="background-plus" points="6 6 0 6 0 8 6 8 6 14 8 14 8 8 14 8 14 6 8 6 8 0 6 0"/>
                            <polygon class="foreground-plus" points="6 6 0 6 0 8 6 8 6 14 8 14 8 8 14 8 14 6 8 6 8 0 6 0" transform="translate(5 5)"/>
                        </g>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    <div class="product-detail-body">
        <h4 class="secondary">Preis und Menge</h4>
        <div class="columns product-detail-row row-1">
            <div class="last-period">
                <h5 class="large">Vorperiode</h5>
            </div>
            <div class="middle-section"></div>
            <div class="current-period">
                <h5 class="large">Aktuelle Periode</h5>
            </div>
        </div>
        <div class="columns product-detail-row row-2">
            <div class="last-period">
                <div class="data-input-area">
                    <h6>Normal Preis &ndash; Alter Artikel</h6>
                    <div class="last-period-price">
                        <div class="number">{{ (preismeldung$ | async).refPreismeldung.preis | pefFormatNumber: numberFormattingOptions }}</div>
                        <div class="unit">CHF</div>
                    </div>
                    <div class="last-period-quantity">
                        <div class="number">{{ (preismeldung$ | async).refPreismeldung.menge }}</div>
                        <div class="unit">{{ (preismeldung$ | async).warenkorbPosition.standardeinheit.de }}</div>
                    </div>
                    <div class="last-period-bottom-row">
                        <ion-list radio-group>
                            <ion-item>
                                <ion-label>Aktion</ion-label>
                                <ion-radio value="aktion" [disabled]="true" [checked]="(preismeldung$ | async).refPreismeldung.aktion"></ion-radio>
                            </ion-item>
                            <ion-item>
                                <ion-label>Ausverkauf</ion-label>
                                <ion-radio value="ausverkauf" [disabled]="true" [checked]="(preismeldung$ | async).refPreismeldung.ausverkauf"></ion-radio>
                            </ion-item>
                        </ion-list>
                        <div class="code">R1</div>
                    </div>
                </div>
                <div class="box-container" *ngIf="showChainedReplacementFields$ | async">
                    <div class="box">
                        &mdash;
                    </div>
                    <div class="arrow down"></div>
                </div>
            </div>
            <div class="middle-section">
                <div class="box-container">
                    <div class="box" [innerHTML]="formatPercentageChange((preismeldung$ | async)?.preismeldung.percentageLastPeriodToCurrentPeriod)"></div>
                    <div class="arrow right"></div>
                </div>
            </div>
            <div class="current-period">
                <div class="data-input-area">
                    <h6>Normal Preis</h6>
                    <ion-list>
                        <ion-item class="pef-item">
                            <ion-label class="currency-label">CHF</ion-label>
                            <ion-input
                                type="number"
                                min="0.05" step="0.05"
                                pef-highlight-on-focus
                                [pef-format-number]="numberFormattingOptions"
                                (blur)="formValueChanged$.emit('currentPeriodPrice')"
                                formControlName="currentPeriodPrice"></ion-input>
                        </ion-item>
                        <div class="unit-item-wrapper">
                            <ion-item class="pef-item">
                                <button class="unit-button" ion-button color="mercury" (click)="applyUnitQuickEqual$.emit()">{{ (preismeldung$ | async).warenkorbPosition.standardeinheit.de }}</button>
                                <ion-input
                                    type="number"
                                    step="any"
                                    formControlName="currentPeriodQuantity"
                                    (blur)="formValueChanged$.emit('currentPeriodQuantity')"
                                    pef-highlight-on-focus></ion-input>
                            </ion-item>
                            <div class="unit-button-wrapper">
                                <button class="unit-button" ion-button color="mercury" (click)="applyUnitQuickEqual$.emit()">{{ (preismeldung$ | async).warenkorbPosition.standardeinheit.de }}</button>
                            </div>
                        </div>
                    </ion-list>
                    <ion-list radio-group class="reduction-radio-group-list">
                        <ion-item>
                            <ion-label>Aktion</ion-label>
                            <ion-radio #radioAktion value="aktion" (click)="toggleReduction$.emit('aktion')" [checked]="(reduction$ | async) == 'aktion'"></ion-radio>
                        </ion-item>
                        <ion-item>
                            <ion-label>Ausverkauf</ion-label>
                            <ion-radio #radioAusverkauf value="ausverkauf" (click)="toggleReduction$.emit('ausverkauf')" [checked]="(reduction$ | async) == 'ausverkauf'"></ion-radio>
                        </ion-item>
                    </ion-list>
                    <processing-code formControlName="currentPeriodProcessingCode" (change)="formValueChanged$.emit('currentPeriodProcessingCode')"></processing-code>
                </div>
            </div>
        </div>
        <div class="columns product-detail-row row-3">
            <div class="last-period">
                <div class="data-input-area" *ngIf="showChainedReplacementFields$ | async">
                    <h6>Normal Preis &ndash; Neuer Artikel</h6>
                    <ion-list>
                        <ion-item class="pef-item">
                            <ion-label>CHF</ion-label>
                            <ion-input type="number" min="0.05" step="0.05" pef-highlight-on-focus [pef-format-number]="numberFormattingOptions"></ion-input>
                        </ion-item>
                        <ion-item class="pef-item">
                            <ion-label>{{ (preismeldung$ | async).warenkorbPosition.standardeinheit.de }}</ion-label>
                            <ion-input type="number" step="any" pef-highlight-on-focus></ion-input>
                        </ion-item>
                    </ion-list>
                </div>
            </div>
            <div class="middle-section">
                <div class="middle-section-container-wrapper">
                    <div class="box-container" *ngIf="showChainedReplacementFields$ | async">
                        <div class="arrow up-right"></div>
                        <div class="box">
                            &mdash;
                        </div>
                    </div>
                </div>
            </div>
            <div class="current-period">
                <button ion-button color="java" class="save-button" [class.with-top-margin]="!(showChainedReplacementFields$ | async)" (click)="attemptSave$.emit($event)">Erfassung speichern</button>
            </div>
        </div>
        <div class="columns product-detail-row row-4">
            <div class="last-period"></div>
            <div class="middle-section"></div>
            <div class="current-period">
                <button ion-button color="java" class="save-button" [class.with-top-margin]="!(showChainedReplacementFields$ | async)" (click)="attemptSave$.emit($event)">Erfassung speichern</button>
            </div>
        </div>
    </div>
</form>
<div class="message" *ngIf="!(preismeldung$ | async)">
    Keine Preismeldung selektiert.
</div>
