<div class="dashboard-content">
    <div class="pef-toolbar">
        <div class="app-info-container">
            <div class="app-name">LIK</div>
            <button ion-button class="pef-toolbar-button person-button" (click)="navigateToPreiserheber$.emit()">
                <div class="person-icon">
                    <pef-icon name="person"></pef-icon>
                </div>
            </button>
        </div>
        <div class="settings-buttons-container">
            <button ion-button class="pef-toolbar-button" (click)="navigateToSettings$.emit()">
                <pef-icon name="settings"></pef-icon>
            </button>
        </div>
    </div>
    <div class="work-area">
        <div class="preismeldestellen">
            <div class="header-line">
                <h3>{{ 'heading_choose-preismeldestelle' | translate }}</h3>
                <div class="current-time">{{ currentTime$ | async | pefDateTranslate:'dddd, DD.MM.YYYY HH:mm' }}</div>
            </div>
            <pef-search-input class="pms-search" (valueChanges)="filterTextValueChanges.emit($event)"></pef-search-input>
            <div class="pms-header-table">
                <div class="pms-header-row">
                    <div class="pms-header-cell pms-name">
                        <div class="pms-header-cell-content">{{ 'heading_preismeldestelle' | translate }}</div>
                    </div>
                    <div class="pms-header-cell pms-flag">
                        <div class="pms-header-cell-content"></div>
                    </div>
                    <div class="pms-header-cell pms-open-unsaved">
                        <div class="pms-header-cell-content">
                            <pef-icon name="todo"></pef-icon>
                        </div>
                    </div>
                    <div class="pms-header-cell pms-open-saved">
                        <div class="pms-header-cell-content">
                            <pef-icon name="checkmark"></pef-icon>
                        </div>
                    </div>
                    <div class="pms-header-cell pms-uploaded">
                        <div class="pms-header-cell-content">
                            <pef-icon name="upload"></pef-icon>
                        </div>
                    </div>
                    <div class="pms-header-cell pms-actions">
                        <div class="pms-header-cell-content"></div>
                    </div>
                </div>
            </div>
            <ion-content pef-perfect-virtualscroll-scrollbar class="preismeldungen-scroll" [enabled]="isDesktop$ | async">
                <div class="pms-table" [virtualScroll]="filteredPreismeldestellen$ | async" approxItemHeight="56px">
                    <div class="pms-row" *virtualItem="let preismeldestelle">
                        <div class="pms-cell pms-nummer">
                            <div class="pms-cell-content">
                                <a ion-button clear class="pms-detail-link" (click)="navigateToDetails$.emit(preismeldestelle)">
                                    <pef-icon name="shop"></pef-icon>
                                    <pef-floating-icon [icon-name]="'warning'" [bottom-right]="true" *ngIf="preismeldestelle.keinErhebungsart"></pef-floating-icon>
                                </a>
                                {{ preismeldestelle.pmsNummer }}
                            </div>
                        </div>
                        <div class="pms-cell pms-name">
                            <div class="pms-cell-content">
                                <div class="pms-name-text"> {{ preismeldestelle.name }} </div>
                            </div>
                        </div>
                        <div class="pms-cell pms-flag">
                            <div class="pms-cell-content"></div>
                        </div>
                        <div class="pms-cell pms-open-unsaved">
                            <div class="pms-cell-content">{{ ((preismeldungenStatistics$ | async) || {})[preismeldestelle.pmsNummer]?.openUnsavedCount
                                }}
                            </div>
                        </div>
                        <div class="pms-cell pms-open-saved">
                            <div class="pms-cell-content">{{ ((preismeldungenStatistics$ | async) || {})[preismeldestelle.pmsNummer]?.openSavedCount }}</div>
                        </div>
                        <div class="pms-cell pms-uploaded">
                            <div class="pms-cell-content" [class.completed-pms]="isPreismeldestelleCompleted(preismeldestelle)">
                                {{ ((preismeldungenStatistics$ | async) || {})[preismeldestelle.pmsNummer]?.uploadedCount }}/{{ ((preismeldungenStatistics$
                                | async) || {})[preismeldestelle.pmsNummer]?.totalCount }}
                            </div>
                        </div>
                        <div class="pms-cell pms-actions">
                            <div class="pms-cell-content">
                                <a ion-button icon-only class="price-entry-button" [class.visibility-hidden]="!preismeldestelle.isPdf || preismeldestelle.keinErhebungsart"
                                    href="javascript:" (click)="createPmsPdf$.emit(preismeldestelle)">
                                    <pef-icon name="pdf"></pef-icon>
                                </a>
                                <a ion-button icon-only class="price-entry-button" [class.visibility-hidden]="preismeldestelle.keinErhebungsart" href="javascript:"
                                    (click)="navigateToPriceEntry$.emit(preismeldestelle)">
                                    <pef-icon name="todo"></pef-icon>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </ion-content>
        </div>
        <div class="preismeldungen">
            <div class="header-line">
                <h3>{{ 'heading_manage-preismeldestelle' | translate }}</h3>
            </div>
            <div class="summary">
                {{ 'text_erhebungsmonat' | translate }}: {{ erhebungsmonat$ | async | pefDateTranslate:'MMMM YYYY' }}
            </div>
            <div class="statistics">
                <ion-content>
                    <div class="row">
                        <pef-icon name="download"></pef-icon>
                        <div class="number">{{ (preismeldungenStatistics$ | async)?.total.downloadedCount }}</div>
                        <div class="text">{{ 'text_preismeldung_heruntergeladene' | translate }}</div>
                    </div>
                    <div class="row">
                        <pef-icon name="todo"></pef-icon>
                        <div class="number">{{ (preismeldungenStatistics$ | async)?.total.openUnsavedCount }}</div>
                        <div class="text">{{ 'text_preismeldung_offen-nicht-erfasst' | translate }}</div>
                    </div>
                    <div class="row">
                        <pef-icon name="checkmark"></pef-icon>
                        <div class="number">{{ (preismeldungenStatistics$ | async)?.total.openSavedCount }}</div>
                        <div class="text">{{ 'text_preismeldung_offen-erfasst' | translate }}</div>
                    </div>
                    <div class="row">
                        <pef-icon name="upload"></pef-icon>
                        <div class="number">{{ (preismeldungenStatistics$ | async)?.total.uploadedCount }}</div>
                        <div class="text">{{ 'text_preismeldung_hochgeladene' | translate }}</div>
                    </div>
                </ion-content>
            </div>
            <div class="actions">
                <div class="status">
                    <span [hidden]="!(syncError$ | async)" class="error">{{ (syncError$ | async) | translate }}</span>
                    <span [hidden]="!(loginError$ | async)" class="error">{{loginError$ | async}}</span>
                    <pef-icon name="sorting_arrows" class="syncing" [hidden]="!(isSyncing$ | async)"></pef-icon>
                    <pef-icon name="wifi" class="connectivity" [class.error]="!(canConnectToDatabase$ | async)"></pef-icon>
                </div>
                <div class="row">
                    <div class="number">{{ (preismeldungenStatistics$ | async)?.total.openSavedCount || 0 }}</div>
                    <div class="text">{{ 'text_preismeldung_erfasste' | translate }}</div>
                </div>
                <div class="row" *ngIf="!!(lastSyncedAt$ | async)">
                    <div class="number">&nbsp;</div>
                    <div class="text">
                        {{ 'text_database-last-synced-at' | translate }}:
                        <br> {{ (lastSyncedAt$ | async) | pefDateTranslate: 'DD MMMM YYYY HH:mm:ss' }}
                    </div>
                </div>
                <div class="buttons">
                    <button ion-button type="button" (click)="loginClicked$.emit($event)" [hidden]="!(showLogin$ | async)" [disabled]="(isSyncing$ | async)">{{ 'btn_login' | translate }}</button>
                    <button ion-button type="button" (click)="synchronizeClicked$.emit($event)" [hidden]="!(canSync$ | async)" [disabled]="(isSyncing$ | async)">{{ 'btn_synchronize' | translate }}</button>
                    <button ion-button type="button" (click)="uploadPreismeldungenClicked$.emit($event)" [disabled]="!(canSync$ | async) || (showLogin$ | async) || (isSyncing$ | async) || !(hasOpenSavedPreismeldungen$ | async)">{{ 'btn_upload-now' | translate }}</button>
                </div>
            </div>
        </div>
    </div>
</div>
